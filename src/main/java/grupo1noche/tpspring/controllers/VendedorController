import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/vendedor")
public class VendedorController {

    private final VendedorService vendedorService;

    @Autowired
    public VendedorController(VendedorService vendedorService) {
        this.vendedorService = vendedorService;
    }

    @GetMapping("/listar")
    public List<Vendedor> listarVendedores() {
        return vendedorService.listarVendedores();
    }

    @PostMapping("/crear")
    public String crearVendedor(@RequestParam("dir") String dir,
                                @RequestParam("nombre") String nombre,
                                @RequestParam("lat") double lat,
                                @RequestParam("lng") double lng) {
        vendedorService.crearVendedor(dir, nombre, lat, lng);
        return "Vendedor creado correctamente";
    }

    @PostMapping("/modificar")
    public String modificarVendedor(@RequestParam("id") int id,
                                    @RequestParam("dir") String dir,
                                    @RequestParam("nombre") String nombre) {
        vendedorService.modificarVendedor(id, dir, nombre);
        return "Vendedor modificado correctamente";
    }

    @PostMapping("/eliminar")
    public String eliminarVendedor(@RequestParam("id") int id) {
        try {
            vendedorService.eliminarVendedor(id);
            return "Vendedor eliminado correctamente";
        } catch (ClavesForaneasException ex) {
            return "Error al eliminar el vendedor: " + ex.getMessage();
        }
    }

    @GetMapping("/buscar")
    public Vendedor buscarVendedor(@RequestParam("id") int id) {
        return vendedorService.buscarVendedor(id);
    }
}
